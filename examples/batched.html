<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>title</title>
<style>

  div {
    margin-bottom: 1em;
    background: silver;
  }

</style>
</head>
<body>
  <button id="button">Go</button>
  <div id='div1'></div>
  <div id='div2'></div>
  <div id='div3'></div>
  <script type="text/javascript" src="../lib/dom-batch.js"></script>
  <script>
    var dom = new DomBatch();

    var button = document.getElementById('button');
    var div1 = document.getElementById('div1');
    var div2 = document.getElementById('div2');
    var div3 = document.getElementById('div3');

    function go() {

      var h = Math.round(Math.random() * 300);

      dom.write(function() {
        div1.style.height = h + 'px';

        // Read
        dom.read(function() {
          h = Math.round(Math.random() * div1.clientHeight);

          // Write
          dom.write(function() {
            div2.style.height = h + 'px';

            // Read
            dom.read(function() {
              h = Math.round(Math.random() * div2.clientHeight);

              // Write
              dom.write(function() {
                div3.style.height = h + 'px';
              });
            });
          });
        });
      });
    }

    button.onclick = go;
  </script>
</body>
</html>